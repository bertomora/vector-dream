# 2026-02-17 - Vector Dream NFT Fixes

## Summary
Major fixes to the Vector Dream NFT minting pipeline. All issues resolved.

---

## Issues Fixed

### 1. Thumbnail Not Loading on OpenSea
**Problem:** OpenSea refresh was called BEFORE Vercel deployed, so it fetched old/empty metadata.

**Fix:** Moved OpenSea refresh to AFTER Vercel deployment in `scripts/process-new-mints.js`

```javascript
// OLD (broken):
1. Upload image to Arweave
2. Refresh OpenSea  ← API still has OLD data!
3. Update API file
4. Deploy to Vercel

// NEW (fixed):
1. Upload image to Arweave
2. Update API file
3. Deploy to Vercel
4. Refresh OpenSea  ← API now has NEW image URL ✓
```

### 2. Contract URL Mismatch
**Problem:** Contract points to `vector-dream.vercel.app` but deployment was only aliased to `vector-dreamz.vercel.app`

**Fix:** Added both aliases in `vercel.json`:
```json
"alias": ["vector-dreamz.vercel.app", "vector-dream.vercel.app"]
```

### 3. Duplicate Token Names
**Problem:** Only 64 name combinations (8 × 8) caused duplicates like "Palm Pulse #3" and "Palm Pulse #14"

**Fix:** Expanded vocabulary in `api/dynamic/[tokenId].js`:
- 32 prefixes × 32 places = 1024 combinations
- Uses `seed % 32` and `floor(seed / 32) % 32`

### 4. Seed Mismatch in Metadata
**Problem:** API used tokenId as seed instead of actual on-chain seed

**Fix:** Added `TOKEN_SEEDS` map that stores real seeds, script updates it automatically

### 5. Git Push Failures
**Problem:** Script's `git push` failed when remote had newer commits

**Fix:** Added `git pull --rebase` before push in `scripts/process-new-mints.js`

### 6. Vercel Auto-Deploy Broken
**Problem:** GitHub integration wasn't triggering Vercel deploys

**Fix:** Script now runs `vercel --prod` directly (doesn't rely on GitHub webhook)

---

## GitHub Actions Workflow
Created `.github/workflows/process-mints.yml` for independent operation (runs even when OpenClaw is off)

**Required Secrets:**
- `PRIVATE_KEY` - Wallet key for Arweave uploads
- `OPENSEA_API_KEY` - For metadata refresh
- `VERCEL_TOKEN` - Get from https://vercel.com/account/tokens
- `VERCEL_ORG_ID` - `team_0maSpX08qusL39DwvZfuMUhq`
- `VERCEL_PROJECT_ID` - `prj_VfZ1uvzRYRONRqAlNd19mG3N4dEE`

---

## Key Files Modified

### `scripts/process-new-mints.js`
- OpenSea refresh moved to after deploy
- Git pull --rebase before push
- Vercel token support for GitHub Actions
- Updates both ARWEAVE_IMAGES and TOKEN_SEEDS

### `api/dynamic/[tokenId].js`
- Expanded name vocabulary (32 × 32 = 1024 combos)
- TOKEN_SEEDS map for real on-chain seeds
- Uses real seed for traits/names/descriptions

### `vercel.json`
- Both aliases: `vector-dreamz.vercel.app` and `vector-dream.vercel.app`

### `.github/workflows/process-mints.yml`
- Runs every 5 minutes
- Independent of OpenClaw

---

## Current Working Flow
1. User mints token
2. GitHub Actions (or OpenClaw cron) runs every 5 min
3. Script detects new mint, gets seed from contract
4. Renders art with Puppeteer, uploads PNG to Arweave
5. Updates API file with ARWEAVE_IMAGES + TOKEN_SEEDS
6. Git commit → pull --rebase → push
7. `vercel --prod` deploys directly
8. OpenSea refresh (AFTER deploy)
9. Thumbnail appears on OpenSea ✓

---

## Contract Info
- Address: `0xbae88927f84adc3a16aa3a41340631f5f285fa0a`
- Chain: Base
- TokenURI: `https://vector-dream.vercel.app/api/dynamic/{tokenId}?seed={seed}`
- Animation: `https://gateway.irys.xyz/J4bJx08zZmM1QEIPMbi9xfO3ICekBgyvzqrDPe4Y04I`

---

## Git Commits (in order)
1. `fix: use real on-chain seeds + reliable vercel deploy`
2. `fix: add vector-dream.vercel.app alias (contract uses this URL)`
3. `fix: refresh OpenSea AFTER Vercel deploy (thumbnail fix)`
4. `feat: add GitHub Actions workflow for processing mints`
5. `fix: expand name vocabulary to 1024 combinations (no duplicates)`
